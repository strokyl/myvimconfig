<%@ page language="java" %>
<%@ page import="org.apache.regexp.*" %>
<%@ page import="java.io.*" %>
<%@ page import="java.util.*" %>
<%@ page import="com.airfrance.utilities.UpdateString" %>
<%@ taglib uri="/WEB-INF/tlds/IWAirfrance.tld" prefix="af" %>
<%@ taglib uri="/WEB-INF/tlds/xtags.tld" prefix="xtags" %>
<%-- **************************************************************** --%>
<%-- Description : <dcrtype>/list.tpl                              --%>
<%-- **************************************************************** --%>
<%-- Writes content of the page               		               --%>
<%-- **************************************************************** --%>
<%-- Auteurs    | Date       | Description                            --%>
<%-- SChrisment | 11/12/2014 | Creation                               --%>
<%-- **************************************************************** --%>
<af:pt name="recherche.tpl" id="dcrFiche"> 
	<af:getTplParams key="docRoot" id="docRoot" />
	<af:getTplParams key="backingstore" id="backingstore" />
	<af:getTplParams key="branch" id="branch" />
	<af:getTplParams key="iwmount" id="iwmount" />
	<af:getTplParams key="workarea" id="workarea" />
	<af:getTplParams key="generationLanguage" id="generationLanguage" />
	<af:getTplParams key="currentType" id="currentType" />
	<af:getTplParams key="defaultColor" id="defaultColor" />

<%-- Recherche de la conf du bloc de droite --%>
<af:langVariable lang="<%=generationLanguage%>" id="wConfBlocDroite" select="/record/item[@name='ConfigBlocs']/value/item[@name='confFlashActus']/value"/>
<%
String DcrConfBlocPath = "/"+generationLanguage+"/g_includeConfigBloc/defaultArticle.jsp" ;   
if (wConfBlocDroite != null && ! "".equals(wConfBlocDroite.trim())) {
	DcrConfBlocPath = "/"+generationLanguage+"/g_includeConfigBloc/" + wConfBlocDroite.replace(".dcr",".jsp"); 
}
%>

<body>

		<%-- ================================ --%> 
		<%-- Recupere la liste des resultats  --%> 
		<%-- ================================ --%>
		<%--<af:langVariable lang="<%=generationLanguage%>" id="urlRss" select="/record/item[@name='FlashActu']/value/item[@name='urlRss']/value"/>
		<% String wurlRss = urlRss + "&count=30";--%>


	

		<%-- ================================ --%> 
		<%-- Entete 		     	        				--%> 
		<%-- ================================ --%>
		<jsp:include page="<%= "../../../../admin/includeTpl/body_entete.tpl" %>" flush="true" />

		<%-- ================================ --%> 
		<%-- CONTENT             			        --%> 
		<%-- ================================ --%>			
    <div id="structure-page" class="container">
      <div class="row"> <%-- début du row qui divise le contenu du menu --%>

          <%-- contenu   --%>
          <div id="main-contenu" class="col-md-9 equalizer-contenu-menu">

					<af:langVariable lang="<%=generationLanguage%>" id="titrePageRecherche" select="/record/item[@name='Recherche']/value/item[@name='titrePageRecherche']/value"/>


						<%-- ================================ --%> 
						<%-- Traceur 		     	        				--%> 
						<%-- ================================ --%>
						<af:setTplParams key="traceurLib_1" value="Résultats de Recherche" /> 
						<af:setTplParams key="traceurUrl_1" value="" /> 
						<af:setTplParams key="traceurLib_2" value="" /> 
						<af:setTplParams key="traceurUrl_2" value="" /> 
						<jsp:include page="<%= "../../../../admin/includeTpl/body_traceur.tpl" %>" flush="true" />

         
            <div class="container-fluid">
              <div class="row">
                <div class="col-sm-12">
                  <div id="titre-page">
                    <h1>Résultats de Recherche</h1>
                  </div>
                </div>
              </div>

            
							<%-- ================================ --%> 
							<%-- LISTE DES RESULTATS        	    --%> 
							<%-- ================================ --%>			
             
              <div id="liste-recherche" class="row">
                <div class="col-sm-12 col" id="containerpagelistsearch">									
								</div> <!-- col-sm-12 col -->                                
              </div>   <!-- liste-actus -->              

            </div> <!-- container-fluid -->

          </div>
          <!-- fin du contenu   -->


				<div id="result"></div>



					<%-- ================================ --%> 
					<%-- Blocs de DROITE                	--%> 
					<%-- ================================ --%>

          <!-- debut du menu   -->
          <div id="main-menu" class="col-md-3 equalizer-contenu-menu">

            <div class="container-fluid">
              <div class="row">

                <div class="col-sm-12">
                  
									<%-- ================================ --%> 
									<%-- Blocs de droite                 	--%> 
									<%-- ================================ --%>
									
									<af:jspScript>
									<!jsp:include page="<%=DcrConfBlocPath%>"/>
									</af:jspScript>								
                  
                </div>

              </div>
            </div>

          </div>
          <!-- fin du blocs   -->

      </div> <!-- FIN du row qui divise le contenu du menu -->

    </div> <!-- FIN Content page   -->
    
    
    
		<%-- ================================ --%> 
		<%-- Footer                        	 --%> 
		<%-- ================================ --%>
		<jsp:include page="<%= "../../../../admin/includeTpl/footer.tpl" %>" flush="true" />
       
		<%-- ================================ --%> 
		<%-- Bootstrap                      	--%> 
		<%-- ================================ --%>
		<jsp:include page="<%= "../../../../admin/includeTpl/bootstrap.tpl" %>" flush="true" />
    


<script>
afficherRecherche("");

function afficherRecherche(urlRss){
					// MODIFIER LE QUERY
					$.ajax('http://search.airfrance.fr/search/search.do',
									{
										data : 'action=emanagerSearch&pageLanguage=fr&query=a380',
										type: 'GET',
										crossDomain: true,
										success: function(data) {
										    printRecherche(data);
										},
										error: function() {
										   
										}
									});
}
							
function printRecherche(data){
	
				var json = JSON.parse(data);

				var item_html = "<br>";			
				$.each( json.results, function( i, item ) {
					
					  // Pas sur pour la lang comment ca marche car deja defini dans la recherche ? a voir
					  // on peut prendre indent pour affichage comme sur search
						if (item.lang=="fr"){
								var date = new Date(item.date);

								item_html += '<div class="row menu-flash-actu-item">';	
							  item_html += '		<div class="col-sm-12">';	
							  item_html += '			<div class="menu-flash-actu-news-date">';
							  item_html += date.getDate() + "/" + date.getMonth() + "/" + date.getFullYear() ;
							  item_html += '			</div>';
							  item_html += '			<div><a href="' + item.url  + '" target="_blank">';
							  item_html += item.title;
							  item_html += '			</a></div>';
							  item_html += '			<p>';	
							  item_html += item.snippet;	
							  item_html += '			<p>';	
							  item_html += '		</div>';	
							  item_html += '</div>';
					}
				});		
								
				$('#containerpagelistsearch').html(item_html);				

}
		
</script>	



</body>

</af:pt>	

