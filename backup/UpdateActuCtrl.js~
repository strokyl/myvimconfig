'use strict';

var UpdateActuCtrl = function ($scope, $injector, $routeParams, $translate, $location, $window, BrancheService, ActuService, ImageService, ActuForm){
	//because of the factorisation of the code between createActu et updateActu
	$scope.createActu = false;
	
	//actuFile could be a full url (sce allow to escape it correctly as an url)
	$scope.actuFile = $sce.trustAsResourceUrl($routeParams.actuFile.replace(/\.dcr$/,""));
	//$scope.actuFile = $routeParams.actuFile.replace(/\.dcr$/,"");
	
	$scope.actu = {};
	//on récupère les informations déjà existante sur l'actualité
	var promise = ActuService.get({brancheName:$routeParams.brancheName, actuFile:$scope.actuFile});
	
	$scope.actu = promise;
	
	promise.$then(function(promise) {
		$scope.actu.actuFile = promise.data.actuFile.replace(/\.dcr$/,"");
		$scope.actuDate = promise.data.actuDate;
	});

	var injectorParam = {
		 $scope : $scope,	
         $routeParams : $routeParams,	
         $translate : $translate,	
         $location : $location,	
         $window : $window,	
         ActuService : ActuService,
         BrancheService: BrancheService,
         ImageService : ImageService,
         ActuForm : ActuForm
         };

	$injector.invoke(EditActuCtrl, this, injectorParam);
};

UpdateActuCtrl.prototype = Object.create(EditActuCtrl.prototype);

angular.module('Ngwis.Controllers')
.controller('UpdateActuCtrl', ['$scope', '$injector', '$routeParams', '$translate', '$location', '$window', 'BrancheService', 'ActuService', 'ImageService', 'ActuForm', UpdateActuCtrl]);
