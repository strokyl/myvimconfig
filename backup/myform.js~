/**
 * 
 */
angular.module('Ngwis.Directives').directive("myform", function() {
	return {
		restrict : 'E',
		templateUrl : 'template/myform.html',
		scope : {
			//the tree
			form : '=',
			//a callback called when a node is clicked
			myformSubmit : '&',
			//if this tree is a subtree of an other tree this node will be the father of the first tree'
			resource : '=',
            brancheName : "=?",
            images : "=?"
		},
		controller : function($scope) {
            $scope.isMulltyLang = function(field) {
                return field.id.constructor === Array;
            };

            $scope.showIf = function(field) {
                return !field.displayIf || $scope.resource[field.displayIf];
            }

            console.log($scope.form);
		}
	}
}).directive("myfield", ['$modal', function($modal) {
    return {
        restrict: 'E',
        templateUrl : 'template/myfield.html',
        scope : {
            fieldId : '@',
            label : '@',
            type : '@',
            resource : '=',
            images : "=?",
            brancheName : "=?",
            choices : "=?"
        },
        controller : function($scope) {

            $scope.openGallerie = function(field) {
                var modalInstance = $modal.open({
                    templateUrl :'template/gallery.html',
                    controller : 'GalleryCtrl',
                    size: "lg",
                    resolve: {
                        images: function () {
                            return $scope.images;
                        },
                        uploadUrl: function () {
                            return "resources/images/" + $scope.brancheName;
                        }
                    }
                });
                
                modalInstance.result.then(function(selectedImage) {
                    $scope.resource[$scope.fieldId] = selectedImage.url;
                });
            };

        }
    }
}]);
