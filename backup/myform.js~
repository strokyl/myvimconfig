/**
 * 
 */
angular.module('Ngwis.Directives').directive("myform", function() {
	return {
		restrict : 'E',
		templateUrl : 'template/myform.html',
		scope : {
			form : '=',
			resource : '='
		},
		controller : function($scope) {
            $scope.isMulltyLang = function(field) {
                return field.id.constructor === Array;
            };

            $scope.showIf = function(field) {
                return !field.displayIf || $scope.resource[field.displayIf];
            }
		}
	}
}).directive("myfield", ['$modal', function($modal) {
    return {
        restrict: 'E',
        templateUrl : 'template/myfield.html',
        scope : {
            fieldId : '@',
            label : '@',
            type : '@',
            resource : '=',
            files : "=?",
            filetype : "=?",
            imageWidth : "=?",
            brancheName : "=?",
            choices : "=?"
        },
        controller : function($scope) {

            $scope.getFileName = function(url) {
                if(url) {
                    return url.split("/").pop();
                }
            }

            $scope.openGallerie = function(field, files, brancheName, filetype) {
                console.log("imageWidth", $scope.imageWidth);
                var modalInstance = $modal.open({
                    templateUrl :'template/gallery.html',
                    controller : 'GalleryCtrl',
                    size: "lg",
                    resolve: {
                        files: function () {
                            return files;
                        },
                        uploadUrl: function () {
                            var url = "resources/files/" + $scope.brancheName + $scope.imageWidth ? "/" + $scope.imageWidth : "";
                            console.log("url", url);
                            return url;
                        },
                        filetype : function () {
                            return filetype;
                        },
                        imageWidth : function() {
                            return $scope.imageWidth;
                        }
                    }
                });
                
                modalInstance.result.then(function(selectedImage) {
                    $scope.resource[$scope.fieldId] = selectedImage;
                });
            };

        }
    }
}]);
