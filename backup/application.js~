'use strict';

/* App Module */
var App = angular.module(
		'Ngwis',
		[ 'pascalprecht.translate', 'Ngwis.Controllers', 'Ngwis.Directives', 'Ngwis.Filter', 
				'Ngwis.Directives.Menu', 'Ngwis.Directives.Security', 'ngRoute', 'ui.bootstrap', 'ngTable',
				'Ngwis.Services', 'ui.tinymce', 'angularFileUpload','RecursionHelper', 'Ngwis.Directives.PrettyFileInput']).config(
		[ '$routeProvider', function($routeProvider) {

			$routeProvider.when('/user', {
				templateUrl : 'views/user.html',
				controller : 'UserCtrl',
			}).when('/home', {
				templateUrl : 'views/home.html',
				controller : 'HomeCtrl'
			}).when('/site/:brancheName?', {
				templateUrl : 'views/site.html',
				controller : 'SiteCtrl'
			}).when('/403', {
				templateUrl : 'views/access403.html'
			}).when('/userDetail/:login', {
				templateUrl : 'views/userDetail.html',
				controller : 'UserCtrl'
					//actuFile could be a url the * say to angular js that it could be an url
			}).when('/updateActu/:brancheName/:actuFile*', {
				templateUrl : 'views/actuForm.html',
				controller : 'UpdateActuCtrl'
			}).when('/addActu/:brancheName', {
				templateUrl : 'views/actuForm.html',
				controller : 'AddActuCtrl'
			})
			.otherwise({
				redirectTo : '/site/'
			});
		} ]).config([ '$httpProvider', function($httpProvider) {
	var interceptor = [ '$rootScope', '$q', function($rootScope, $q) {
		function success(response) {
			return response;
		}
		;

		function error(response) {
			console.log("Error from server status = " + response.status);
			if ((response.status === 403) || (response.status === 401)) {
				window.location = "./index.html#/403";
			}

			// otherwise, default behaviour
			return $q.reject(response);
		}

		return function(promise) {
			return promise.then(success, error);
		};

	} ];
	$httpProvider.responseInterceptors.push(interceptor);
} ]).config([ '$translateProvider', function($translateProvider) {
	// Ajout des tables de traduction
	$translateProvider
        .translations('fr', ngwisfr_FR)
	    .translations('en', ngwisen_EN)
        .registerAvailableLanguageKeys(['fr', 'en'], {
            'en_US': 'en',
            'en_UK': 'en',
            'fr_FR': 'fr',
            'fr_CA': 'fr',
            'en' : 'en',
            'fr': 'fr'
            });
        $translateProvider.determinePreferredLanguage();
} ]);
